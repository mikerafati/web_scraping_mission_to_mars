!function(e){var t=e.fancybox;t.helpers.thumbs={defaults:{width:75,height:50,position:"bottom",source:function(){}},list:null,items:null,count:0,_create:function(t){var i,n,s=this.opts;i="",e.each(t.group,function(e){i+='<li><a data-index="'+e+'" href="javascript:jQuery.fancybox.jumpto('+e+');"></a></li>'}),this.list=n=e("<ul>"+i+"</ul>"),this.items=n.children(),this.count=this.items.length,this.wrap=e('<div id="fancybox-thumbs" class="'+s.position+'"></div>').append(n).wrapInner('<div class="inner" />').wrapInner('<div class="outer" />').appendTo("body"),e('<a class="fancybox-thumb-prev" href="javascript:;"><span></span></a>').click(e.proxy(this.prev,this)).prependTo(this.wrap),e('<a class="fancybox-thumb-next" href="javascript:;"><span></span></a>').click(e.proxy(this.next,this)).appendTo(this.wrap),n.find("a").width(s.width).height(s.height),this.width=this.items.outerWidth(!0),this.height=this.items.outerHeight(!0),n.width(this.width*this.count).height(this.height)},_loadPage:function(){var i,n,s=this,o=function(e){s._setThumb(i,e)};this.list&&(i=this.list.find("a").slice(this.start,this.end+1).not(".ready").first(),i&&i.length&&(i.addClass("ready"),n=t.group[i.data("index")],href=this._getThumb(n,o),"string"===e.type(href)?o(href):href||this._loadPage()))},_getThumb:function(t,i){var n,s;return n=this.opts.source(t,i),!n&&t.element&&(n=e(t.element).find("img").attr("src")),!n&&(s=t.href.match(/(youtube\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed\/?)?(videoseries\?list=(.*)|[\w-]{11}|\?listType=(.*)&list=(.*)).*/i))&&(n="http://img.youtube.com/vi/"+s[3]+"/mqdefault.jpg"),!n&&(s=t.href.match(/(?:vimeo(?:pro)?.com)\/(?:[^\d]+)?(\d+)(?:.*)/))?(e.getJSON("http://www.vimeo.com/api/v2/video/"+s[1]+".json?callback=?",{format:"json"},function(e){i(e[0].thumbnail_small)}),!0):(!n&&"image"===t.type&&t.href&&(n=t.href),n)},_setThumb:function(t,i){var n=this,s=function(){n._loadPage()};this.list&&e("<img />").load(function(){var i,o,r=this.width,a=this.height,l=t.width(),c=t.height();return n.wrap&&r&&a?(i=r/l,o=a/c,i>=1&&o>=1&&(i>o?(r/=o,a=c):(r=l,a/=i)),e(this).css({width:Math.floor(r),height:Math.floor(a),"margin-top":Math.floor(.3*c-.3*a),"margin-left":Math.floor(.5*l-.5*r)}).appendTo(t),void s()):void s()}).error(s).attr("src",i)},_move:function(i){var n,s,o,r=0,a=400;if(this.wrap){if(n=Math.ceil(this.count/this.itemsMin),void 0===i&&(i=Math.floor(t.current.index/this.itemsMin)+1),e(".fancybox-thumb-prev, .fancybox-thumb-next").hide(),2>n)return e.extend(this,{pages:n,page:1,start:0,end:this.count}),this.list.stop(!0).css({"margin-left":"auto","margin-right":"auto",left:0}),void this._loadPage();1>=i?i=1:e(".fancybox-thumb-prev").show(),i>=n?i=n:e(".fancybox-thumb-next").show(),s=(i-1)*this.itemsMin,o=s+this.itemsMax-1,r=this.width*this.itemsMin*(i-1)*-1,this.left!==r&&(e.extend(this,{pages:n,page:i,start:s,end:o,left:r}),this._loadPage(),this.list.stop(!0).animate({"margin-left":r+"px"},a))}},prev:function(){this._move(this.page-1)},next:function(){this._move(this.page+1)},afterLoad:function(e,t){var i="bottom"===e.position?2:0;return t.group.length<2?void(t.helpers.thumbs=!1):(this.wrap||this._create(t),void(e.margin!==!1&&(t.margin[i]=Math.max(this.height+40,t.margin[i]))))},beforeShow:function(e,t){this.items&&(this.items.removeClass("fancybox-thumb-active"),this.current=this.list.find("a[data-index='"+t.index+"']").parent().addClass("fancybox-thumb-active"))},onUpdate:function(){this.wrap&&(this.wrap.width(t.getViewport().w),this.view=this.list.parent().innerWidth(),this.itemsMin=Math.floor(this.view/this.width),this.itemsMax=Math.ceil(this.view/this.width),this._move())},beforeClose:function(){this.wrap&&this.wrap.stop(!0).remove(),e.extend(this,{pages:0,page:0,start:0,end:0,count:0,items:null,left:null,wrap:null,list:null})}}}(jQuery);